(page "dom-churn.html")

(html
  (head
    (title "DOM churn examples")
    (style "input {float: left; clear: left;"))

  (body
    (div
      :id "input-list"
      (let [values (cell {})
            values+final (cell= (into values {:new nil}))
            on-input! (fn [id v] (reset! values (->>
                                                  ; Update values.
                                                  (merge @values {id v})
                                                  ; Filter empty strings.
                                                  (remove #(let [[_ v] %] (= "" v)))
                                                  ; Ensure we have a map.
                                                  (into {}))))]
        (loop-tpl :bindings [[k v] values+final]
          (let [id (cell= (if (= :new k) (gensym) k))]
            (input
              :value v
              :id id
              :input #(on-input! @id @%))))))))
